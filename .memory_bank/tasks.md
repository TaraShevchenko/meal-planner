# ЗАДАЧИ ПРОЕКТА MEAL PLANNER

## ТЕКУЩИЕ ЗАДАЧИ

### Приоритет 1: Подготовка к продакшену

- [x] Обновить описание приложения в README.md
- [x] Создать memory bank с архитектурой и техническими требованиями
- [x] **Интеграция Clerk (ЗАВЕРШЕНО)**
  - [x] Настройка Clerk Dashboard
  - [x] Интеграция @clerk/nextjs
  - [x] Создание страниц входа и регистрации
  - [x] Настройка middleware для защиты маршрутов
  - [x] Тестирование авторизации в dev режиме
  - [x] Обновление API auth.ts для совместимости с Clerk
- [x] **Миграция на Neon PostgreSQL (ЗАВЕРШЕНО)**
  - [x] Принятие решения о переходе с Supabase на Neon
  - [x] Анализ текущей архитектуры и зависимостей
  - [x] Создать проект в Neon
  - [x] Обновить DATABASE_URL в переменных окружения
  - [x] Удалить @supabase/supabase-js зависимость
  - [x] Удалить файл src/shared/config/supabase.ts
  - [x] Обновить env.js (убрать Supabase переменные)
  - [x] Обновить .env и .env.example (убрать Supabase переменные)
  - [x] Обновить README.md (заменить Supabase на Neon)
  - [x] Применить Prisma схему к Neon БД
  - [x] Протестировать подключение через Prisma
  - [x] **Интеграция пользователей Clerk с Prisma (ЗАВЕРШЕНО)**
    - [x] ✅ Создан детальный план интеграции (CLERK_NEON_INTEGRATION.md)
    - [x] ✅ Обновлена модель User в Prisma схеме (добавлены поля firstName, lastName, username, clerkCreatedAt, clerkUpdatedAt)
    - [x] ✅ Создан webhook endpoint для синхронизации пользователей (/api/webhooks/clerk)
    - [x] ✅ Реализованы функции синхронизации (handleUserCreated, handleUserUpdated, handleUserDeleted)
    - [x] ✅ Добавлена переменная окружения CLERK_WEBHOOK_SECRET
    - [x] ✅ Установлена зависимость svix для обработки webhooks
    - [x] ✅ Применены изменения схемы к базе данных (prisma db push)
    - [x] ✅ Создана функция ensureUserExists для fallback синхронизации
    - [x] ✅ Обновлены функции auth.ts для работы с базой данных
    - [x] ✅ Исправлены все ошибки типизации TypeScript
    - [x] ✅ Сервер разработки успешно запущен и работает
    - [x] ✅ Протестирована синхронизация пользователей (логин, регистрация, обновления)
  - [x] Настройка автоматических бэкапов в Neon (включены по умолчанию)
  - [x] Обновление документации проекта
- [x] **Настройка разработки через ngrok (ЗАВЕРШЕНО)**
  - [x] Проброс локального сервера в интернет для тестирования
  - [x] Настройка webhook endpoints для внешних сервисов
  - [x] Тестирование интеграций в dev режиме
- [x] **Создание схемы данных для MVP приложения (ЗАВЕРШЕНО)**
  - [x] Анализ старой схемы из предыдущей итерации (mvp_schema/old_schema.prisma)
  - [x] Проектирование новой схемы с учетом Clerk интеграции (см. mvp_schema/schema-analysis.md)
  - [x] Функционал выходного веса - добавлена поддержка учета изменения веса при готовке
  - [x] Система единиц измерения - спроектирована гибкая система единиц (г, мл, шт, порции)
  - [x] История фасовок - добавлена модель для отслеживания всех измерений пользователя
  - [x] Упрощение схемы MVP - переименование Recipe в Meal, упрощение моделей Ingredient и PortionHistory, удаление полей системы порций из Meal, удаление UnitConverter
  - [x] Улучшение структуры PortionHistory - замена полей grams/servings на универсальные amount/unit для поддержки граммов, штук и порций
  - [x] Создание итоговой схемы MVP (mvp_schema/mvp-schema.prisma)
  - [x] Документирование схемы (mvp_schema/README.md)
  - [x] Примеры использования API (mvp_schema/usage-examples.md)
  - [x] Обновление технических спецификаций (technical-specs.md)
  - [x] Обновление описания моделей данных (data-models-description.md)
- [x] **Внедрение схемы данных MVP в проект (ЗАВЕРШЕНО)**
  - [x] Создание новой Prisma схемы на основе mvp-schema.prisma
  - [x] Создание моделей данных в Prisma:
    - [x] Продукты/Ингредиенты (Ingredients) - базовая информация о продуктах
    - [x] Блюда (Meals) - рецепты с составом и БЖУ
    - [x] Быстрые блюда (QuickMeals) - приблизительные блюда для питания вне дома
    - [x] Записи питания (MealEntries) - планирование и фактические приемы пищи
    - [x] Семьи (Families) - группировка пользователей для семейного режима
    - [x] Списки покупок (ShoppingLists) - автоматически генерируемые списки
    - [x] История порций (PortionHistory) - персонализированная история размеров порций
    - [x] Фасовки ингредиентов (IngredientPackaging) - информация о магазинных упаковках
  - [x] Настройка связей между моделями и индексов
  - [x] Применение миграций к базе данных
  - [x] Исправление конфликтов схемы с помощью prisma migrate reset
  - [x] Создание миграции init-mvp-schema и успешное применение к Neon БД
  - [x] Валидация схемы - база данных синхронизирована с Prisma схемой
  - [x] Документирование процесса миграции данных от dev к prod (production-migration-plan.md)
  - [ ] Создание seed данных для тестирования
  - [ ] Реализация системы конверсий - создание утилит для работы с единицами измерения
  - [ ] UI для управления единицами - интерфейс для выбора единиц и просмотра истории
- [ ] **Создание базового API и компонентов для MVP (СЛЕДУЮЩАЯ ЗАДАЧА)**
  - [ ] Настройка tRPC роутеров для основных сущностей
  - [ ] Создание API endpoints для ингредиентов
  - [ ] Создание API endpoints для блюд и быстрых блюд
  - [ ] Создание API endpoints для записей питания
  - [ ] Создание базовых React компонентов для управления данными
  - [ ] Интеграция с Clerk для авторизации в API
  - [ ] Тестирование API функциональности

## ОПИСАНИЕ ПРИЛОЖЕНИЯ

Приложение для удобного контроля питания и учета продуктов. Основной функционал:

### Основные возможности:

- **Планнер-дневник питания** - планирование и отметка приемов пищи
- **Учет пищевой ценности** - контроль БЖУ и калорий
- **Система блюд** - рецепты с стабильным составом
- **Быстрые блюда** - для питания вне дома с приблизительным БЖУ
- **Гибкие единицы измерения** - граммы, порции, штуки
- **История порций** - сохранение популярных размеров порций
- **Семейный режим** - планирование для нескольких пользователей
- **Список покупок** - автоматическое формирование на основе меню
- **Детальный режим дня** - подробная информация о приготовлении блюд

### Технический стек:

- **Frontend:** Next.js 15, React 19, TypeScript
- **Backend:** tRPC, Prisma ORM
- **База данных:** PostgreSQL (Neon)
- **Авторизация:** Clerk
- **Стилизация:** Tailwind CSS, Radix UI
- **Архитектура:** T3 Stack

### Статус проекта:

**Текущий статус:** Схема данных MVP успешно внедрена с упрощенными единицами измерения ✅

**Следующие шаги:**

1. 🔄 **СЛЕДУЮЩАЯ ЗАДАЧА:** Создание базового API и компонентов для MVP
2. Создание seed данных для тестирования
3. Развертывание на Vercel с рабочей авторизацией
4. Создание базового дашборда
5. Реализация основного функционала MVP

**Готово к разработке:** 
- ✅ Полная авторизация с синхронизацией пользователей
- ✅ Полная схема данных MVP с миграциями
- ✅ База данных Neon синхронизирована с Prisma
- ✅ Упрощение единиц измерения (удалены KILOGRAMS, MILLILITERS, LITERS)
