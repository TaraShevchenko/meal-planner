# Описание моделей MVP схемы Meal Planner

Данный документ содержит подробное описание всех моделей базы данных приложения Meal Planner, их назначения и описания полей в соответствии с актуальной схемой Prisma.

## Оглавление

1. [Пользователи и семейный режим](#пользователи-и-семейный-режим)
2. [Ингредиенты](#ингредиенты)
3. [Блюда и быстрые блюда](#блюда-и-быстрые-блюда)
4. [Планирование приемов пищи](#планирование-приемов-пищи)
5. [Система порций](#система-порций)
6. [Списки покупок](#списки-покупок)
7. [Перечисления (Enums)](#перечисления-enums)

---

## Пользователи и семейный режим

### User (Пользователи)

**Назначение**: Основная модель пользователя, интегрированная с системой аутентификации Clerk.

| Поле             | Тип       | Описание                                                        |
| ---------------- | --------- | --------------------------------------------------------------- |
| `id`             | String    | Уникальный идентификатор пользователя из Clerk (первичный ключ) |
| `email`          | String    | Email пользователя (уникальный)                                 |
| `firstName`      | String?   | Имя пользователя (опционально)                                  |
| `lastName`       | String?   | Фамилия пользователя (опционально)                              |
| `name`           | String?   | Полное имя (вычисляемое поле: firstName + lastName)             |
| `imageUrl`       | String?   | URL аватара пользователя                                        |
| `username`       | String?   | Имя пользователя (уникальное, опционально)                      |
| `clerkCreatedAt` | DateTime? | Дата создания в Clerk                                           |
| `clerkUpdatedAt` | DateTime? | Дата обновления в Clerk                                         |
| `createdAt`      | DateTime  | Дата создания записи в приложении                               |
| `updatedAt`      | DateTime  | Дата последнего обновления                                      |

**Связи**: Связан со всеми основными сущностями приложения (ингредиенты, блюда, записи о приемах пищи и т.д.)

### Family (Семьи)

**Назначение**: Модель для группировки пользователей в семьи для совместного планирования питания.

| Поле        | Тип      | Описание                       |
| ----------- | -------- | ------------------------------ |
| `id`        | String   | Уникальный идентификатор семьи |
| `name`      | String   | Название семьи                 |
| `createdAt` | DateTime | Дата создания                  |
| `updatedAt` | DateTime | Дата последнего обновления     |

### FamilyMember (Члены семьи)

**Назначение**: Связующая модель между пользователями и семьями (many-to-many).

| Поле        | Тип      | Описание                        |
| ----------- | -------- | ------------------------------- |
| `id`        | String   | Уникальный идентификатор записи |
| `familyId`  | String   | Идентификатор семьи             |
| `userId`    | String   | Идентификатор пользователя      |
| `createdAt` | DateTime | Дата добавления в семью         |
| `updatedAt` | DateTime | Дата последнего обновления      |

**Ограничения**: Пользователь может быть только один раз в одной семье.

---

## Ингредиенты

### Ingredient (Ингредиенты)

**Назначение**: Основные продукты и ингредиенты, используемые в приготовлении блюд.

| Поле     | Тип    | Описание                             |
| -------- | ------ | ------------------------------------ |
| `id`     | String | Уникальный идентификатор ингредиента |
| `userId` | String | Идентификатор владельца              |
| `name`   | String | Название ингредиента                 |

| `calories` | Float? | Калорийность на 100г (по умолчанию 0) |
| `protein` | Float? | Белки на 100г (по умолчанию 0) |
| `carbs` | Float? | Углеводы на 100г (по умолчанию 0) |
| `fat` | Float? | Жиры на 100г (по умолчанию 0) |
| `gramsPerPiece` | Float? | Вес одной штуки в граммах (для штучных продуктов) |
| `createdAt` | DateTime | Дата создания |
| `updatedAt` | DateTime | Дата последнего обновления |

**Связи**: Связан с пользователем, используется в блюдах, записях о приемах пищи, истории порций, списках покупок и имеет информацию о фасовках.

### IngredientPackaging (Фасовки ингредиентов)

**Назначение**: Информация о различных упаковках ингредиентов в магазинах.

| Поле           | Тип             | Описание                                              |
| -------------- | --------------- | ----------------------------------------------------- |
| `id`           | String          | Уникальный идентификатор                              |
| `ingredientId` | String          | Идентификатор ингредиента                             |
| `packageName`  | String          | Название фасовки (например, "Пачка 500г", "Банка 1л") |
| `packageSize`  | Float           | Размер упаковки (например, 500.0)                     |
| `unit`         | MeasurementUnit | Единица измерения (г, кг, л, мл, шт, порции)          |
| `storeName`    | String?         | Название магазина (опционально)                       |
| `createdAt`    | DateTime        | Дата создания                                         |
| `updatedAt`    | DateTime        | Дата последнего обновления                            |

---

## Блюда и быстрые блюда

### Meal (Блюда)

**Назначение**: Рецепты блюд, состоящие из нескольких ингредиентов с инструкциями по приготовлению.

| Поле              | Тип      | Описание                                   |
| ----------------- | -------- | ------------------------------------------ |
| `id`              | String   | Уникальный идентификатор блюда             |
| `userId`          | String   | Идентификатор создателя                    |
| `name`            | String   | Название блюда                             |
| `description`     | String?  | Описание блюда                             |
| `instructions`    | String?  | Инструкции по приготовлению                |
| `expectedYield`   | Float?   | Ожидаемый выход готового блюда в граммах   |
| `actualYield`     | Float?   | Фактический выход готового блюда в граммах |
| `prepTime`        | Int?     | Время подготовки в минутах                 |
| `cookTime`        | Int?     | Время готовки в минутах                    |
| `gramsPerServing` | Float?   | Размер одной порции в граммах              |
| `createdAt`       | DateTime | Дата создания                              |
| `updatedAt`       | DateTime | Дата последнего обновления                 |

### MealIngredient (Ингредиенты в блюдах)

**Назначение**: Связывает блюда с ингредиентами и указывает количество каждого ингредиента в рецепте.

| Поле           | Тип             | Описание                                     |
| -------------- | --------------- | -------------------------------------------- |
| `id`           | String          | Уникальный идентификатор                     |
| `mealId`       | String          | Идентификатор блюда                          |
| `ingredientId` | String          | Идентификатор ингредиента                    |
| `amount`       | Float           | Размер порции ингредиента                    |
| `unit`         | MeasurementUnit | Единица измерения (г, кг, л, мл, шт, порции) |

**Связи**:

- `meal` → Meal (блюдо)
- `ingredient` → Ingredient (ингредиент)

**Ограничения**: Уникальная комбинация блюда и ингредиента.

### QuickMeal (Быстрые блюда)

**Назначение**: Простые блюда без детального рецепта, с заранее известной пищевой ценностью.

| Поле              | Тип      | Описание                      |
| ----------------- | -------- | ----------------------------- |
| `id`              | String   | Уникальный идентификатор      |
| `userId`          | String   | Идентификатор создателя       |
| `name`            | String   | Название быстрого блюда       |
| `description`     | String?  | Описание                      |
| `calories`        | Float?   | Калорийность на 100г          |
| `protein`         | Float?   | Белки на 100г                 |
| `carbs`           | Float?   | Углеводы на 100г              |
| `fat`             | Float?   | Жиры на 100г                  |
| `gramsPerServing` | Float?   | Размер одной порции в граммах |
| `createdAt`       | DateTime | Дата создания                 |
| `updatedAt`       | DateTime | Дата последнего обновления    |

---

## Планирование приемов пищи

### MealEntry (Записи о приемах пищи)

**Назначение**: Основная модель для планирования и отслеживания приемов пищи.

| Поле        | Тип       | Описание                                                     |
| ----------- | --------- | ------------------------------------------------------------ |
| `id`        | String    | Уникальный идентификатор                                     |
| `userId`    | String    | Идентификатор пользователя                                   |
| `date`      | DateTime  | Дата планирования (день, месяц, год)                         |
| `mealTime`  | DateTime? | Время выполнения (null = планируется, заполнено = выполнено) |
| `mealType`  | MealType  | Тип приема пищи (завтрак, обед, ужин, перекус)               |
| `createdAt` | DateTime  | Дата создания                                                |
| `updatedAt` | DateTime  | Дата последнего обновления                                   |

### MealEntryIngredient (Ингредиенты в приемах пищи)

**Назначение**: Связь между записями о приемах пищи и отдельными ингредиентами.

| Поле               | Тип    | Описание                                        |
| ------------------ | ------ | ----------------------------------------------- |
| `id`               | String | Уникальный идентификатор                        |
| `mealEntryId`      | String | Идентификатор записи о приеме пищи              |
| `ingredientId`     | String | Идентификатор ингредиента                       |
| `portionHistoryId` | String | Связь с историей порций для указания количества |

**Ограничения**: Уникальная комбинация записи о приеме пищи и ингредиента.

### MealEntryMeal (Блюда в приемах пищи)

**Назначение**: Связь между записями о приемах пищи и блюдами.

| Поле               | Тип    | Описание                                        |
| ------------------ | ------ | ----------------------------------------------- |
| `id`               | String | Уникальный идентификатор                        |
| `mealEntryId`      | String | Идентификатор записи о приеме пищи              |
| `mealId`           | String | Идентификатор блюда                             |
| `portionHistoryId` | String | Связь с историей порций для указания количества |

**Ограничения**: Уникальная комбинация записи о приеме пищи и блюда.

### MealEntryQuickMeal (Быстрые блюда в приемах пищи)

**Назначение**: Связь между записями о приемах пищи и быстрыми блюдами.

| Поле               | Тип    | Описание                                        |
| ------------------ | ------ | ----------------------------------------------- |
| `id`               | String | Уникальный идентификатор                        |
| `mealEntryId`      | String | Идентификатор записи о приеме пищи              |
| `quickMealId`      | String | Идентификатор быстрого блюда                    |
| `portionHistoryId` | String | Связь с историей порций для указания количества |

**Ограничения**: Уникальная комбинация записи о приеме пищи и быстрого блюда.

---

## Система порций

### PortionHistory (История порций)

**Назначение**: Отслеживание часто используемых размеров порций для удобства пользователя.

| Поле        | Тип             | Описание                                     |
| ----------- | --------------- | -------------------------------------------- |
| `id`        | String          | Уникальный идентификатор                     |
| `userId`    | String          | Идентификатор пользователя                   |
| `itemId`    | String          | ID элемента (ingredient, meal, quickMeal)    |
| `itemType`  | ItemType        | Тип элемента                                 |
| `amount`    | Float           | Размер порции                                |
| `unit`      | MeasurementUnit | Единица измерения (г, кг, л, мл, шт, порции) |
| `frequency` | Int             | Частота использования данной порции          |
| `lastUsed`  | DateTime        | Дата последнего использования                |
| `createdAt` | DateTime        | Дата создания                                |
| `updatedAt` | DateTime        | Дата последнего обновления                   |

**Ограничения**: Уникальная комбинация пользователя, элемента и типа элемента.

**Связи**: Связан с пользователем и может ссылаться на ингредиенты, блюда или быстрые блюда. Используется в записях о приемах пищи для указания количества.

---

## Списки покупок

### ShoppingList (Списки покупок)

**Назначение**: Автоматически генерируемые списки покупок на основе планов питания.

| Поле        | Тип       | Описание                                      |
| ----------- | --------- | --------------------------------------------- |
| `id`        | String    | Уникальный идентификатор                      |
| `ownerId`   | String    | Идентификатор владельца (userId или familyId) |
| `ownerType` | OwnerType | Тип владельца (USER или FAMILY)               |
| `name`      | String    | Название списка                               |
| `dateFrom`  | DateTime  | Начальная дата периода планирования           |
| `dateTo`    | DateTime  | Конечная дата периода планирования            |
| `createdAt` | DateTime  | Дата создания                                 |
| `updatedAt` | DateTime  | Дата последнего обновления                    |

### ShoppingListItem (Элементы списка покупок)

**Назначение**: Отдельные позиции в списке покупок с указанием количества и статуса.

| Поле           | Тип                | Описание                                                  |
| -------------- | ------------------ | --------------------------------------------------------- |
| `id`           | String             | Уникальный идентификатор                                  |
| `listId`       | String             | Идентификатор списка покупок                              |
| `ingredientId` | String             | Идентификатор ингредиента                                 |
| `totalGrams`   | Float              | Общее количество в граммах                                |
| `status`       | ShoppingItemStatus | Статус покупки (нужно купить, проверить наличие, куплено) |

| `createdAt` | DateTime | Дата создания |
| `updatedAt` | DateTime | Дата последнего обновления |

**Ограничения**: Один ингредиент может быть только один раз в списке.

---

## Перечисления (Enums)

### MealType (Типы приемов пищи)

**Назначение**: Классификация приемов пищи по времени дня.

| Значение    | Описание |
| ----------- | -------- |
| `BREAKFAST` | Завтрак  |
| `LUNCH`     | Обед     |
| `DINNER`    | Ужин     |
| `SNACK`     | Перекус  |

### ItemType (Типы элементов)

**Назначение**: Классификация типов элементов в системе.

| Значение     | Описание      |
| ------------ | ------------- |
| `INGREDIENT` | Ингредиент    |
| `MEAL`       | Блюдо         |
| `QUICK_MEAL` | Быстрое блюдо |

### ShoppingItemStatus (Статусы элементов списка покупок)

**Назначение**: Отслеживание статуса покупки каждого элемента.

| Значение             | Описание               |
| -------------------- | ---------------------- |
| `MUST_BUY`           | Точно нужно купить     |
| `CHECK_AVAILABILITY` | Проверить наличие дома |
| `BOUGHT`             | Уже куплено            |

### OwnerType (Типы владельцев)

**Назначение**: Определение типа владельца списка покупок.

| Значение | Описание                   |
| -------- | -------------------------- |
| `USER`   | Личный список пользователя |
| `FAMILY` | Семейный список            |

---

## Ключевые особенности архитектуры

### Система единиц измерения

- Все количества хранятся в граммах для унификации
- Поддержка штучных продуктов через поле `gramsPerPiece`
- Гибкая система фасовок для удобства покупок

### Функционал выходного веса

- Отслеживание ожидаемого и фактического выхода блюд
- Помогает в точном планировании порций

### Система порций

- Автоматическое запоминание часто используемых размеров порций
- Упрощает повторное планирование питания

### Семейный режим

- Возможность совместного планирования питания
- Общие списки покупок для семьи

### Интеграция с Clerk

- Готовая система аутентификации
- Безопасное управление пользователями
