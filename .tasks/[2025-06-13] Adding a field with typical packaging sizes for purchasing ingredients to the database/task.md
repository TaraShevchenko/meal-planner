# MEMORY BANK - MEAL PLANNER PROJECT

## CURRENT TASK

**–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—è —Å —Ç–∏–ø–∏—á–Ω—ã–º–∏ —Ñ–∞—Å–æ–≤–∫–∞–º–∏ –¥–ª—è –ø–æ–∫—É–ø–∫–∏ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤ –≤ –ë–î**

### TASK DESCRIPTION

–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–µ –ø–æ–ª–µ –≤ –º–æ–¥–µ–ª—å –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤, –∫–æ—Ç–æ—Ä–æ–µ –±—É–¥–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Å–ø–∏—Å–æ–∫ –≤–æ–∑–º–æ–∂–Ω—ã—Ö —Ñ–∞—Å–æ–≤–æ–∫ (–≥—Ä–∞–º–º–æ–≤–æ–∫/–æ–±—ä—ë–º–æ–≤) –¥–ª—è –ø–æ–∫—É–ø–∫–∏ –¥–∞–Ω–Ω–æ–≥–æ —Ç–æ–≤–∞—Ä–∞ –≤ –º–∞–≥–∞–∑–∏–Ω–µ. –≠—Ç–æ –ø–æ–ª–µ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –±–æ–ª–µ–µ —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã—Ö —Å–ø–∏—Å–∫–æ–≤ –ø–æ–∫—É–ø–æ–∫.

### COMPLEXITY LEVEL: 3

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:** –ó–∞–¥–∞—á–∞ —Ç—Ä–µ–±—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ö–µ–º—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö, —Å–æ–∑–¥–∞–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏, –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ª–æ–≥–∏–∫–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–ø–∏—Å–∫–æ–≤ –ø–æ–∫—É–ø–æ–∫. –ó–∞—Ç—Ä–∞–≥–∏–≤–∞–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ —Å–∏—Å—Ç–µ–º—ã.

### REQUIREMENTS ANALYSIS

1. **Database Schema Changes:**

    - –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ `availablePackageSizes` —Ç–∏–ø–∞ –º–∞—Å—Å–∏–≤ —á–∏—Å–µ–ª –≤ –º–æ–¥–µ–ª—å `Ingredients`
    - –°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é Prisma –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ë–î

2. **Admin Interface Updates:**

    - –û–±–Ω–æ–≤–∏—Ç—å —Ñ–æ—Ä–º—É —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤
    - –î–æ–±–∞–≤–∏—Ç—å UI –¥–ª—è –≤–≤–æ–¥–∞ –º–∞—Å—Å–∏–≤–∞ —Ñ–∞—Å–æ–≤–æ–∫
    - –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö (—Ç–æ–ª—å–∫–æ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ —á–∏—Å–ª–∞)

3. **Shopping List Logic:**
    - –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –∞–ª–≥–æ—Ä–∏—Ç–º –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–ø–∏—Å–∫–æ–≤ –ø–æ–∫—É–ø–æ–∫
    - –£—á–∏—Ç—ã–≤–∞—Ç—å –±–ª–∏–∂–∞–π—à—É—é –±–æ–ª—å—à—É—é –¥–æ—Å—Ç—É–ø–Ω—É—é —Ñ–∞—Å–æ–≤–∫—É
    - –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–ª—É—á–∞–µ–≤, –∫–æ–≥–¥–∞ —Ñ–∞—Å–æ–≤–∫–∏ –Ω–µ –∑–∞–¥–∞–Ω—ã

### CURRENT PROJECT STRUCTURE

-   **Database:** PostgreSQL —Å Prisma ORM
-   **Framework:** Next.js —Å TypeScript
-   **UI:** Tailwind CSS, –≤–æ–∑–º–æ–∂–Ω–æ Shadcn UI
-   **Architecture:** –ú–æ–¥—É–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (src/module/, src/core/, src/shared/)

### AFFECTED COMPONENTS

1. **Database Layer:**

    - `prisma/schema.prisma` - –º–æ–¥–µ–ª—å Ingredients
    - –ù–æ–≤–∞—è –º–∏–≥—Ä–∞—Ü–∏—è

2. **Admin Interface:**

    - –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤
    - –§–æ—Ä–º—ã –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è

3. **Shopping List Generation:**
    - –õ–æ–≥–∏–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤
    - –ê–ª–≥–æ—Ä–∏—Ç–º –≤—ã–±–æ—Ä–∞ –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–π —Ñ–∞—Å–æ–≤–∫–∏

### IMPLEMENTATION STRATEGY

#### **Phase 1: Database Schema Update**

1. **Prisma Schema Modification**

    - –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ `availablePackageSizes Float[]` –≤ –º–æ–¥–µ–ª—å `Ingredients`
    - –°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Ç–∞–±–ª–∏—Ü—ã
    - –û–±–Ω–æ–≤–∏—Ç—å seed –¥–∞–Ω–Ω—ã–µ —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ —Ñ–∞—Å–æ–≤–æ–∫

2. **TypeScript Types Update**
    - –û–±–Ω–æ–≤–∏—Ç—å —Ç–∏–ø—ã –ø–æ—Å–ª–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ Prisma Client
    - –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å—Ö–µ–º—ã –¥–ª—è –Ω–æ–≤—ã—Ö –ø–æ–ª–µ–π

#### **Phase 2: Admin Interface Development**

1. **Create Ingredients Management Interface**

    - –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –º–æ–¥—É–ª—å `src/module/Ingredients/`
    - –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–ª—è –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤
    - –î–æ–±–∞–≤–∏—Ç—å TRPC –ø—Ä–æ—Ü–µ–¥—É—Ä—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–∞–º–∏

2. **Package Sizes Input Component**

    - –°–æ–∑–¥–∞—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è –≤–≤–æ–¥–∞ –º–∞—Å—Å–∏–≤–∞ —á–∏—Å–µ–ª (—Ñ–∞—Å–æ–≤–æ–∫)
    - –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é (—Ç–æ–ª—å–∫–æ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ —á–∏—Å–ª–∞)
    - –î–æ–±–∞–≤–∏—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω–∏—è/—É–¥–∞–ª–µ–Ω–∏—è —Ñ–∞—Å–æ–≤–æ–∫

3. **Admin Page Creation**
    - –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤
    - –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Ñ–æ—Ä–º—É —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å –Ω–æ–≤—ã–º–∏ –ø–æ–ª—è–º–∏
    - –î–æ–±–∞–≤–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É —Å–æ —Å–ø–∏—Å–∫–æ–º –≤—Å–µ—Ö –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤

#### **Phase 3: Shopping List Logic Enhancement**

1. **Package Size Selection Algorithm**

    - –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å `src/module/Order/model/api.ts`
    - –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é –≤—ã–±–æ—Ä–∞ –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–π —Ñ–∞—Å–æ–≤–∫–∏
    - –£—á–∏—Ç—ã–≤–∞—Ç—å –±–ª–∏–∂–∞–π—à—É—é –±–æ–ª—å—à—É—é –¥–æ—Å—Ç—É–ø–Ω—É—é —Ñ–∞—Å–æ–≤–∫—É

2. **Backward Compatibility**

    - –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤ –±–µ–∑ –∑–∞–¥–∞–Ω–Ω—ã—Ö —Ñ–∞—Å–æ–≤–æ–∫
    - Fallback –∫ —Ç–æ—á–Ω–æ–º—É –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –∏–∑ —Ä–µ—Ü–µ–ø—Ç–∞

3. **UI Updates**
    - –û–±–Ω–æ–≤–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ `OrderTable` –¥–ª—è –ø–æ–∫–∞–∑–∞ —Ñ–∞—Å–æ–≤–æ–∫
    - –î–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–∏–∫–∞—Ü–∏—é –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∫–æ–ª–∏—á–µ—Å—Ç–≤

### POTENTIAL CHALLENGES

1. **Data Migration:** –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã –±—É–¥—É—Ç –∏–º–µ—Ç—å –ø—É—Å—Ç—ã–µ –º–∞—Å—Å–∏–≤—ã —Ñ–∞—Å–æ–≤–æ–∫
2. **UI/UX Design:** –£–¥–æ–±–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –≤–≤–æ–¥–∞ –º–∞—Å—Å–∏–≤–∞ —á–∏—Å–µ–ª
3. **Algorithm Complexity:** –û–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –≤—ã–±–æ—Ä —Ñ–∞—Å–æ–≤–∫–∏ –ø—Ä–∏ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–∞—Ö
4. **Backward Compatibility:** –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤ –±–µ–∑ –∑–∞–¥–∞–Ω–Ω—ã—Ö —Ñ–∞—Å–æ–≤–æ–∫

### DETAILED IMPLEMENTATION STEPS

#### **Phase 1: Database Schema (2-3 hours)**

1. **Modify Prisma Schema** (`prisma/schema.prisma`)

    ```prisma
    model Ingredients {
      // ... existing fields
      availablePackageSizes Float[] @default([])
    }
    ```

2. **Create Migration**

    ```bash
    npx prisma migrate dev --name add_available_package_sizes
    ```

3. **Update Seed Data** (`src/shared/seed/data/Ingredients.data.ts`)
    - –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏–º–µ—Ä—ã —Ñ–∞—Å–æ–≤–æ–∫ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–∞
    - –ì—Ä–µ—á–∫–∞: [500, 1000], –ú–∞—Å–ª–æ: [250, 500, 1000]

#### **Phase 2: Admin Interface (8-10 hours)**

1. **Create Ingredients Module Structure**

    ```
    src/module/Ingredients/
    ‚îú‚îÄ‚îÄ model/
    ‚îÇ   ‚îú‚îÄ‚îÄ api.ts (TRPC procedures)
    ‚îÇ   ‚îú‚îÄ‚îÄ hooks/
    ‚îÇ   ‚îú‚îÄ‚îÄ schemes.ts (validation)
    ‚îÇ   ‚îî‚îÄ‚îÄ types.ts
    ‚îú‚îÄ‚îÄ ui/
    ‚îÇ   ‚îú‚îÄ‚îÄ IngredientsTable/
    ‚îÇ   ‚îú‚îÄ‚îÄ IngredientForm/
    ‚îÇ   ‚îî‚îÄ‚îÄ PackageSizesInput/ üé® CREATIVE COMPONENT
    ‚îî‚îÄ‚îÄ index.ts
    ```

2. **TRPC Procedures** (Add to existing or new router)

    - `getIngredients` (enhance existing)
    - `createIngredient`
    - `updateIngredient`
    - `deleteIngredient`

3. **üé® CREATIVE: Package Sizes Input Component**

    - Dynamic array input with add/remove buttons
    - Real-time validation
    - User-friendly UX for managing multiple values

4. **Admin Page** (`src/app/[locale]/admin/ingredients/page.tsx`)
    - Table with all ingredients
    - Edit/Create forms
    - Package sizes display

#### **Phase 3: Shopping List Enhancement (4-6 hours)**

1. **üé® CREATIVE: Package Selection Algorithm**

    ```typescript
    function selectOptimalPackageSize(requiredAmount: number, availableSizes: number[]): number {
        // Find smallest package that covers required amount
        // Fallback to exact amount if no packages defined
    }
    ```

2. **Modify Order API** (`src/module/Order/model/api.ts`)

    - Include `availablePackageSizes` in ingredient queries
    - Apply package selection logic
    - Update `IngredientOrder` type to include package info

3. **UI Enhancements** (`src/module/Order/ui/OrderTable/OrderTable.tsx`)
    - Show optimized vs required amounts
    - Visual indicators for package optimization

### CREATIVE PHASE COMPONENTS - COMPLETED ‚úÖ

üé® **Component 1: Package Sizes Input Interface** ‚úÖ

-   **Type:** UI/UX Design
-   **Challenge:** Create intuitive interface for managing array of numbers
-   **DECISION:** Dynamic Input List with Add/Remove Buttons
-   **Rationale:** Clearest UX, familiar patterns, best accessibility
-   **Document:** `creative-phase-package-input.md`

üé® **Component 2: Package Selection Algorithm** ‚úÖ

-   **Type:** Algorithm Design
-   **Challenge:** Optimal package selection logic
-   **DECISION:** Simple Smallest-Sufficient Algorithm
-   **Rationale:** Optimal balance of functionality and maintainability
-   **Document:** `creative-phase-algorithm.md`

üé® **Component 3: Shopping List Visualization** ‚úÖ

-   **Type:** UI/UX Design
-   **Challenge:** Clear display of optimized vs required amounts
-   **DECISION:** Expandable Detail Cards
-   **Rationale:** Progressive disclosure, mobile-friendly, accessible
-   **Document:** `creative-phase-visualization.md`

### TECHNOLOGY VALIDATION

‚úÖ **Verified Technologies:**

-   **Database:** PostgreSQL + Prisma (existing)
-   **Backend:** Next.js API + TRPC (existing)
-   **Frontend:** React + TypeScript (existing)
-   **UI:** Tailwind CSS + Shadcn UI (existing)
-   **Forms:** React Hook Form (inferred from existing patterns)

### DEPENDENCIES & INTEGRATION POINTS

1. **Database Dependencies:**

    - Prisma migration system
    - Existing ingredients data

2. **API Dependencies:**

    - Existing TRPC router structure
    - Authentication middleware

3. **UI Dependencies:**
    - Shared UI components
    - Existing form patterns
    - Admin layout structure

### TESTING STRATEGY

1. **Database Testing:**

    - Migration rollback capability
    - Seed data validation

2. **API Testing:**

    - TRPC procedure testing
    - Package selection algorithm unit tests

3. **UI Testing:**
    - Component testing for package input
    - Integration testing for admin flow

### CREATIVE PHASES COMPLETED ‚úÖ

**All Required Creative Phases Completed:**

1. ‚úÖ Package Sizes Input Component design ‚Üí Dynamic Input List
2. ‚úÖ Package Selection Algorithm optimization ‚Üí Simple Smallest-Sufficient
3. ‚úÖ Shopping List visualization enhancement ‚Üí Expandable Detail Cards

**Design Decisions Documented:**
- `creative-phase-package-input.md` - UI/UX design for package input interface
- `creative-phase-algorithm.md` - Algorithm design for package selection
- `creative-phase-visualization.md` - UI/UX design for shopping list display

### NEXT MODE RECOMMENDATION

**IMPLEMENT MODE** - Ready to proceed with implementation using documented design decisions.

**Implementation Order:**
1. Phase 1: Database Schema Update (Prisma migration)
2. Phase 2: Admin Interface Development (with designed input component)
3. Phase 3: Shopping List Logic Enhancement (with designed algorithm and visualization)

---

_Created: 2025-01-13_
_Mode: PLAN ‚Üí CREATIVE ‚Üí READY_FOR_IMPLEMENT_
_Status: CREATIVE_PHASES_COMPLETE_
_Next Mode: IMPLEMENT_
