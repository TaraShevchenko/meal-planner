# Implementation Plan: Meal Planner (Level 4)

## Архитектурный анализ

### Структура проекта Evolution Design
```
src/
├── app/                    # App Router (Next.js 13+)
│   ├── (auth)/            # Route group для аутентификации
│   ├── (dashboard)/       # Route group для основного интерфейса
│   ├── api/               # API routes
│   └── globals.css
├── pages/                 # Pages Router (для tRPC)
│   └── api/
│       └── trpc/
├── widgets/               # Виджеты (композиция features)
│   ├── meal-planner/
│   ├── recipe-manager/
│   ├── family-dashboard/
│   └── grocery-list/
├── features/              # Бизнес-логика
│   ├── auth/
│   ├── meals/
│   ├── recipes/
│   ├── nutrition/
│   ├── family/
│   └── grocery/
├── entities/              # Доменные сущности
│   ├── user/
│   ├── meal/
│   ├── recipe/
│   ├── ingredient/
│   └── family/
└── shared/                # Общие компоненты
    ├── ui/                # shadcn/ui компоненты
    ├── lib/               # Утилиты
    ├── api/               # tRPC клиент
    └── config/            # Конфигурация
```

## Детальные требования

### Функциональные требования
1. **Планировщик питания**
   - Создание/редактирование приемов пищи
   - Отметка съеденного
   - Расчет БЖУ и калорий в реальном времени
   - История питания

2. **Система рецептов**
   - CRUD операции для рецептов
   - Расчет пищевой ценности рецепта
   - Масштабирование порций
   - Быстрые блюда с приблизительным БЖУ

3. **Семейный режим**
   - Управление семьей (добавление/удаление участников)
   - Групповое планирование питания
   - Индивидуальные цели по БЖУ
   - Распределение блюд между участниками

4. **Система заказа продуктов**
   - Автоматическое суммирование ингредиентов
   - Учет магазинных фасовок
   - Категоризация: "купить" vs "проверить наличие"
   - Экспорт списка покупок

### Нефункциональные требования
1. **Производительность**
   - Время загрузки страницы < 2 сек
   - Расчет БЖУ в реальном времени
   - Оптимизация запросов к БД

2. **Безопасность**
   - Google OAuth аутентификация
   - Защита API endpoints
   - Валидация данных на сервере

3. **Масштабируемость**
   - Поддержка множественных семей
   - Горизонтальное масштабирование БД
   - CDN для статических ресурсов

## Компоненты, требующие творческой фазы

### 🎨 Creative Phase Components

1. **Архитектура базы данных**
   - Дизайн схемы для семейного режима
   - Оптимизация для расчета пищевой ценности
   - Индексирование для производительности

2. **UX/UI дизайн**
   - Интерфейс планировщика питания
   - Семейный dashboard
   - Мобильная адаптация

3. **Алгоритм расчета БЖУ**
   - Агрегация пищевой ценности
   - Учет потерь при готовке
   - Масштабирование порций

4. **Система фасовок продуктов**
   - Алгоритм оптимизации покупок
   - База данных фасовок
   - Логика "купить" vs "проверить"

## Фазированная стратегия реализации

### Фаза 1: Основа проекта (2-3 дня)
- [ ] Инициализация T3 Stack проекта
- [ ] Настройка Evolution Design структуры
- [ ] Конфигурация tRPC
- [ ] Интеграция shadcn/ui
- [ ] Настройка Tailwind CSS
- [ ] Базовая конфигурация TypeScript

### Фаза 2: Аутентификация и БД (2-3 дня)
- [ ] Google OAuth интеграция
- [ ] Prisma схема БД
- [ ] Базовые модели (User, Family)
- [ ] Middleware для аутентификации
- [ ] Продакшн развертывание (Vercel + БД)

### Фаза 3: Базовый планировщик (3-4 дня)
- [ ] Модели Meal, Ingredient, Recipe
- [ ] CRUD операции для приемов пищи
- [ ] Базовый расчет БЖУ
- [ ] Простой интерфейс планировщика
- [ ] Отметка съеденного

### Фаза 4: Система рецептов (2-3 дня)
- [ ] CRUD для рецептов
- [ ] Связь рецептов с ингредиентами
- [ ] Расчет пищевой ценности рецепта
- [ ] Масштабирование порций
- [ ] Быстрые блюда

### Фаза 5: Семейный режим (3-4 дня)
- [ ] Модель Family и связи
- [ ] Управление участниками семьи
- [ ] Групповое планирование
- [ ] Индивидуальные цели
- [ ] Семейный dashboard

### Фаза 6: Система заказа продуктов (3-4 дня)
- [ ] Агрегация ингредиентов
- [ ] База данных фасовок
- [ ] Алгоритм оптимизации
- [ ] Интерфейс списка покупок
- [ ] Экспорт функциональность

## Зависимости и интеграционные точки

### Внешние зависимости
1. **Google OAuth API**
   - Настройка Google Cloud Console
   - Конфигурация NextAuth.js
   - Обработка токенов

2. **База данных**
   - Выбор провайдера (Supabase/PlanetScale)
   - Настройка Prisma
   - Миграции

3. **Хостинг**
   - Vercel для Next.js
   - Конфигурация environment variables
   - CI/CD pipeline

### Внутренние зависимости
1. **Entities → Features**
   - Модели данных должны быть готовы перед бизнес-логикой

2. **Features → Widgets**
   - Бизнес-логика перед композицией

3. **Auth → All Features**
   - Аутентификация - базовая зависимость

## Вызовы и решения

### Технические вызовы
1. **Сложность Evolution Design**
   - **Решение:** Постепенное внедрение, начиная с простых компонентов
   - **Митигация:** Документирование паттернов

2. **Производительность расчета БЖУ**
   - **Решение:** Кэширование результатов
   - **Митигация:** Оптимизация запросов, индексы БД

3. **Семейный режим сложность**
   - **Решение:** Поэтапная реализация
   - **Митигация:** Простой MVP, затем расширение

### Продуктовые вызовы
1. **UX сложных сценариев**
   - **Решение:** Пользовательское тестирование
   - **Митигация:** Итеративный дизайн

2. **Точность данных о питании**
   - **Решение:** Интеграция с надежными API
   - **Митигация:** Возможность ручной корректировки

## Критерии готовности

### MVP критерии
- [ ] Работающая аутентификация через Google
- [ ] Базовый планировщик питания
- [ ] Простые рецепты
- [ ] Расчет БЖУ
- [ ] Продакшн развертывание

### v1.0 критерии
- [ ] Полный семейный режим
- [ ] Система заказа продуктов
- [ ] Детальный режим дня
- [ ] Мобильная адаптация
- [ ] Производительность оптимизирована

## Следующие шаги

1. **Немедленно:**
   - Переход в CREATIVE режим для дизайна БД схемы
   - Создание архитектурных диаграмм
   - Детализация UI/UX требований

2. **После Creative фазы:**
   - Переход в IMPLEMENT режим
   - Начало Фазы 1: Основа проекта
   - Настройка продакшн окружения

---

**План создан:** 2024-12-19
**Уровень сложности:** Level 4
**Ожидаемое время реализации:** 15-20 дней
**Требует Creative фазы:** ДА