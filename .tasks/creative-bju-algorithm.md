# üé®üé®üé® ENTERING CREATIVE PHASE: BJU CALCULATION ALGORITHM üé®üé®üé®

**–§–æ–∫—É—Å:** –ê–ª–≥–æ—Ä–∏—Ç–º —Ä–∞—Å—á–µ—Ç–∞ –±–µ–ª–∫–æ–≤, –∂–∏—Ä–æ–≤, —É–≥–ª–µ–≤–æ–¥–æ–≤ (–ë–ñ–£) –∏ –∫–∞–ª–æ—Ä–∏–π
**–¶–µ–ª—å:** –°–æ–∑–¥–∞—Ç—å —Ç–æ—á–Ω—É—é –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—É—é —Å–∏—Å—Ç–µ–º—É —Ä–∞—Å—á–µ—Ç–∞ –ø–∏—â–µ–≤–æ–π —Ü–µ–Ω–Ω–æ—Å—Ç–∏
**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:** –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –µ–¥–∏–Ω–∏—Ü –∏–∑–º–µ—Ä–µ–Ω–∏—è, —Å–µ–º–µ–π–Ω—ã—Ö –Ω–æ—Ä–º, —Ç–æ—á–Ω–æ—Å—Ç—å —Ä–∞—Å—á–µ—Ç–æ–≤

## –ö–û–ù–¢–ï–ö–°–¢ –ò –¢–†–ï–ë–û–í–ê–ù–ò–Ø

### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è:
- –†–∞—Å—á–µ—Ç –ë–ñ–£ –¥–ª—è –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤
- –†–∞—Å—á–µ—Ç –ë–ñ–£ –¥–ª—è —Ä–µ—Ü–µ–ø—Ç–æ–≤ (—Å—É–º–º–∞ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤)
- –†–∞—Å—á–µ—Ç –ë–ñ–£ –¥–ª—è –ø—Ä–∏–µ–º–æ–≤ –ø–∏—â–∏
- –†–∞—Å—á–µ—Ç –¥–Ω–µ–≤–Ω—ã—Ö –∏ –Ω–µ–¥–µ–ª—å–Ω—ã—Ö —Å–≤–æ–¥–æ–∫
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –µ–¥–∏–Ω–∏—Ü –∏–∑–º–µ—Ä–µ–Ω–∏—è (–≥, –∫–≥, –º–ª, –ª, —à—Ç—É–∫–∏, –ø–æ—Ä—Ü–∏–∏)
- –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –º–µ–∂–¥—É –µ–¥–∏–Ω–∏—Ü–∞–º–∏ –∏–∑–º–µ—Ä–µ–Ω–∏—è
- –†–∞—Å—á–µ—Ç –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã—Ö –Ω–æ—Ä–º –¥–ª—è —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ —Å–µ–º—å–∏
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –∫ —Ü–µ–ª–µ–≤—ã–º –ø–æ–∫–∞–∑–∞—Ç–µ–ª—è–º

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:
- –í—ã—Å–æ–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (—Ä–∞—Å—á–µ—Ç—ã –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏)
- –¢–æ—á–Ω–æ—Å—Ç—å —Ä–∞—Å—á–µ—Ç–æ–≤ (–¥–æ 1 –≥—Ä–∞–º–º–∞ –¥–ª—è –ë–ñ–£, –¥–æ 1 –∫–∫–∞–ª –¥–ª—è –∫–∞–ª–æ—Ä–∏–π)
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–æ–≤ –¥–∞–Ω–Ω—ã—Ö (—Å–µ–º—å–∏ —Å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ –ø–ª–∞–Ω–∞–º–∏)
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
- –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ –≥—Ä–∞–Ω–∏—á–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤

### –ë–∏–∑–Ω–µ—Å-—Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è:
- –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º –ø–∏—â–µ–≤–æ–π —Ü–µ–Ω–Ω–æ—Å—Ç–∏
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–æ—Å—Å–∏–π—Å–∫–∏—Ö –∏ –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã—Ö —Å—Ç–∞–Ω–¥–∞—Ä—Ç–æ–≤
- –ì–∏–±–∫–æ—Å—Ç—å –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö –º–µ—Ç—Ä–∏–∫ (–≤–∏—Ç–∞–º–∏–Ω—ã, –º–∏–Ω–µ—Ä–∞–ª—ã)
- –ü—Ä–æ—Å—Ç–æ—Ç–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —ç–∫—Å–ø–æ—Ä—Ç–∞ –¥–∞–Ω–Ω—ã—Ö

## –ê–ù–ê–õ–ò–ó –ü–†–ï–î–ú–ï–¢–ù–û–ô –û–ë–õ–ê–°–¢–ò

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –æ –ø–∏—â–µ–≤–æ–π —Ü–µ–Ω–Ω–æ—Å—Ç–∏
```typescript
interface NutritionData {
  calories: number      // –∫–∫–∞–ª –Ω–∞ 100–≥
  protein: number       // –≥ –Ω–∞ 100–≥
  fat: number          // –≥ –Ω–∞ 100–≥
  carbohydrates: number // –≥ –Ω–∞ 100–≥
  fiber?: number       // –≥ –Ω–∞ 100–≥ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
  sugar?: number       // –≥ –Ω–∞ 100–≥ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
  sodium?: number      // –º–≥ –Ω–∞ 100–≥ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
}

interface Ingredient {
  id: string
  name: string
  nutrition: NutritionData
  defaultUnit: MeasurementUnit
  density?: number     // –≥/–º–ª –¥–ª—è –∂–∏–¥–∫–æ—Å—Ç–µ–π
}
```

### –ï–¥–∏–Ω–∏—Ü—ã –∏–∑–º–µ—Ä–µ–Ω–∏—è –∏ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è
```typescript
type MeasurementUnit = 
  | 'gram' | 'kilogram'
  | 'milliliter' | 'liter'
  | 'piece' | 'portion'
  | 'tablespoon' | 'teaspoon'
  | 'cup' | 'glass'

interface ConversionRule {
  from: MeasurementUnit
  to: MeasurementUnit
  factor: number
  ingredientSpecific?: boolean
}
```

### –¶–µ–ª–µ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ –¥–ª—è —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ —Å–µ–º—å–∏
```typescript
interface NutritionGoals {
  calories: number
  protein: number
  fat: number
  carbohydrates: number
  calculationMethod: 'manual' | 'harris-benedict' | 'mifflin-st-jeor'
}

interface FamilyMember {
  id: string
  name: string
  age: number
  gender: 'male' | 'female'
  weight: number
  height: number
  activityLevel: 'sedentary' | 'light' | 'moderate' | 'active' | 'very-active'
  goals: NutritionGoals
}
```

## –í–ê–†–ò–ê–ù–¢–´ –ê–õ–ì–û–†–ò–¢–ú–ò–ß–ï–°–ö–ò–• –†–ï–®–ï–ù–ò–ô

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ü—Ä–æ—Å—Ç–æ–π –ª–∏–Ω–µ–π–Ω—ã–π —Ä–∞—Å—á–µ—Ç
**–û–ø–∏—Å–∞–Ω–∏–µ:** –ü—Ä—è–º–æ–π —Ä–∞—Å—á–µ—Ç –ë–ñ–£ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–æ–ø–æ—Ä—Ü–∏–π –æ—Ç –±–∞–∑–æ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π –Ω–∞ 100–≥

**–ê–ª–≥–æ—Ä–∏—Ç–º:**
```typescript
function calculateNutrition(ingredient: Ingredient, amount: number, unit: MeasurementUnit): NutritionData {
  // 1. –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ –≥—Ä–∞–º–º—ã
  const gramsAmount = convertToGrams(amount, unit, ingredient)
  
  // 2. –ü—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç
  const factor = gramsAmount / 100
  
  return {
    calories: ingredient.nutrition.calories * factor,
    protein: ingredient.nutrition.protein * factor,
    fat: ingredient.nutrition.fat * factor,
    carbohydrates: ingredient.nutrition.carbohydrates * factor
  }
}

function convertToGrams(amount: number, unit: MeasurementUnit, ingredient: Ingredient): number {
  switch (unit) {
    case 'gram': return amount
    case 'kilogram': return amount * 1000
    case 'milliliter': return amount * (ingredient.density || 1)
    case 'liter': return amount * 1000 * (ingredient.density || 1)
    case 'piece': return amount * (ingredient.averageWeight || 100)
    case 'portion': return amount * (ingredient.portionWeight || 150)
    default: throw new Error(`Unsupported unit: ${unit}`)
  }
}
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –ü—Ä–æ—Å—Ç–æ—Ç–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∏ –ø–æ–Ω–∏–º–∞–Ω–∏—è
- –í—ã—Å–æ–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- –õ–µ–≥–∫–æ—Å—Ç—å –æ—Ç–ª–∞–¥–∫–∏
- –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –ø–∞–º—è—Ç–∏

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–π
- –°–ª–æ–∂–Ω–æ—Å—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö –µ–¥–∏–Ω–∏—Ü –∏–∑–º–µ—Ä–µ–Ω–∏—è
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —É—á–µ—Ç–∞ –ø–æ—Ç–µ—Ä—å –ø—Ä–∏ –≥–æ—Ç–æ–≤–∫–µ
- –ù–µ—Ç –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

**–í—Ä–µ–º–µ–Ω–Ω–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å:** O(1)
**–ü—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å:** O(1)
**–û–±—Ä–∞–±–æ—Ç–∫–∞ –≥—Ä–∞–Ω–∏—á–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤:** –ë–∞–∑–æ–≤–∞—è
**–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å:** –í—ã—Å–æ–∫–∞—è –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö —Å–ª—É—á–∞–µ–≤

### –í–∞—Ä–∏–∞–Ω—Ç 2: –°–∏—Å—Ç–µ–º–∞ —Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∏ –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
**–û–ø–∏—Å–∞–Ω–∏–µ:** –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º —Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤, –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π –¥–∞–Ω–Ω—ã—Ö –∏ –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫

**–ê–ª–≥–æ—Ä–∏—Ç–º:**
```typescript
interface CalculationCache {
  [key: string]: NutritionData
}

class NutritionCalculator {
  private cache: CalculationCache = {}
  private conversionRules: ConversionRule[]
  
  calculateNutrition(ingredient: Ingredient, amount: number, unit: MeasurementUnit): NutritionData {
    // 1. –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
    this.validateInput(ingredient, amount, unit)
    
    // 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫—ç—à–∞
    const cacheKey = this.generateCacheKey(ingredient.id, amount, unit)
    if (this.cache[cacheKey]) {
      return this.cache[cacheKey]
    }
    
    // 3. –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –ø—Ä–∞–≤–∏–ª
    const gramsAmount = this.convertToGramsAdvanced(amount, unit, ingredient)
    
    // 4. –†–∞—Å—á–µ—Ç —Å –æ–∫—Ä—É–≥–ª–µ–Ω–∏–µ–º
    const result = this.calculateWithRounding(ingredient.nutrition, gramsAmount)
    
    // 5. –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
    this.cache[cacheKey] = result
    
    return result
  }
  
  private validateInput(ingredient: Ingredient, amount: number, unit: MeasurementUnit): void {
    if (amount <= 0) throw new Error('Amount must be positive')
    if (!ingredient.nutrition) throw new Error('Ingredient nutrition data is required')
    if (!this.isSupportedUnit(unit)) throw new Error(`Unsupported unit: ${unit}`)
  }
  
  private convertToGramsAdvanced(amount: number, unit: MeasurementUnit, ingredient: Ingredient): number {
    const rule = this.findConversionRule(unit, 'gram', ingredient)
    if (!rule) throw new Error(`No conversion rule found for ${unit} to gram`)
    
    return amount * rule.factor
  }
  
  private calculateWithRounding(nutrition: NutritionData, gramsAmount: number): NutritionData {
    const factor = gramsAmount / 100
    
    return {
      calories: Math.round(nutrition.calories * factor),
      protein: Math.round(nutrition.protein * factor * 10) / 10, // 1 decimal place
      fat: Math.round(nutrition.fat * factor * 10) / 10,
      carbohydrates: Math.round(nutrition.carbohydrates * factor * 10) / 10
    }
  }
  
  // –†–∞—Å—á–µ—Ç –¥–ª—è —Ä–µ—Ü–µ–ø—Ç–æ–≤
  calculateRecipeNutrition(recipe: Recipe): NutritionData {
    return recipe.ingredients.reduce((total, recipeIngredient) => {
      const ingredientNutrition = this.calculateNutrition(
        recipeIngredient.ingredient,
        recipeIngredient.amount,
        recipeIngredient.unit
      )
      
      return {
        calories: total.calories + ingredientNutrition.calories,
        protein: total.protein + ingredientNutrition.protein,
        fat: total.fat + ingredientNutrition.fat,
        carbohydrates: total.carbohydrates + ingredientNutrition.carbohydrates
      }
    }, { calories: 0, protein: 0, fat: 0, carbohydrates: 0 })
  }
}
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –í—ã—Å–æ–∫–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å —Ä–∞—Å—á–µ—Ç–æ–≤
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- –ù–∞–¥–µ–∂–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
- –ì–∏–±–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏
- –•–æ—Ä–æ—à–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**
- –ë–æ–ª–µ–µ —Å–ª–æ–∂–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
- –ë–æ–ª—å—à–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –∫ –ø–∞–º—è—Ç–∏ (–∫—ç—à)
- –°–ª–æ–∂–Ω–æ—Å—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∞–≤–∏–ª –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏
- –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã —Å –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–µ–π –∫—ç—à–∞

**–í—Ä–µ–º–µ–Ω–Ω–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å:** O(1) —Å –∫—ç—à–µ–º, O(n) –¥–ª—è —Ä–µ—Ü–µ–ø—Ç–æ–≤
**–ü—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å:** O(k) –≥–¥–µ k - —Ä–∞–∑–º–µ—Ä –∫—ç—à–∞
**–û–±—Ä–∞–±–æ—Ç–∫–∞ –≥—Ä–∞–Ω–∏—á–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤:** –û—Ç–ª–∏—á–Ω–∞—è
**–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å:** –í—ã—Å–æ–∫–∞—è

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ü—Ä–æ–¥–≤–∏–Ω—É—Ç–∞—è —Å–∏—Å—Ç–µ–º–∞ —Å —É—á–µ—Ç–æ–º –ø–æ—Ç–µ—Ä—å –ø—Ä–∏ –≥–æ—Ç–æ–≤–∫–µ
**–û–ø–∏—Å–∞–Ω–∏–µ:** –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º, —É—á–∏—Ç—ã–≤–∞—é—â–∏–π –ø–æ—Ç–µ—Ä–∏ –ø–∏—Ç–∞—Ç–µ–ª—å–Ω—ã—Ö –≤–µ—â–µ—Å—Ç–≤ –ø—Ä–∏ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Å–ø–æ—Å–æ–±–∞—Ö –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è

**–ê–ª–≥–æ—Ä–∏—Ç–º:**
```typescript
interface CookingMethod {
  id: string
  name: string
  nutritionLossFactors: {
    protein: number    // 0.0 - 1.0 (–¥–æ–ª—è –ø–æ—Ç–µ—Ä—å)
    fat: number
    carbohydrates: number
    vitamins?: number
  }
  weightLossFactor: number // –ø–æ—Ç–µ—Ä—è –≤–µ—Å–∞ –ø—Ä–∏ –≥–æ—Ç–æ–≤–∫–µ
}

interface CookingStep {
  method: CookingMethod
  duration: number // –º–∏–Ω—É—Ç—ã
  temperature?: number // –≥—Ä–∞–¥—É—Å—ã
}

class AdvancedNutritionCalculator extends NutritionCalculator {
  private cookingMethods: CookingMethod[]
  
  calculateCookedNutrition(
    ingredient: Ingredient, 
    amount: number, 
    unit: MeasurementUnit,
    cookingSteps: CookingStep[]
  ): NutritionData {
    // 1. –ë–∞–∑–æ–≤—ã–π —Ä–∞—Å—á–µ—Ç —Å—ã—Ä–æ–≥–æ –ø—Ä–æ–¥—É–∫—Ç–∞
    let nutrition = this.calculateNutrition(ingredient, amount, unit)
    let currentWeight = this.convertToGrams(amount, unit, ingredient)
    
    // 2. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ø–æ—Ç–µ—Ä—å –æ—Ç –≥–æ—Ç–æ–≤–∫–∏
    for (const step of cookingSteps) {
      nutrition = this.applyCookingLosses(nutrition, step)
      currentWeight *= (1 - step.method.weightLossFactor)
    }
    
    // 3. –ü–µ—Ä–µ—Å—á–µ—Ç –Ω–∞ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –≤–µ—Å –≥–æ—Ç–æ–≤–æ–≥–æ –ø—Ä–æ–¥—É–∫—Ç–∞
    const weightFactor = currentWeight / this.convertToGrams(amount, unit, ingredient)
    
    return {
      calories: nutrition.calories * weightFactor,
      protein: nutrition.protein * weightFactor,
      fat: nutrition.fat * weightFactor,
      carbohydrates: nutrition.carbohydrates * weightFactor
    }
  }
  
  private applyCookingLosses(nutrition: NutritionData, step: CookingStep): NutritionData {
    const losses = step.method.nutritionLossFactors
    
    return {
      calories: nutrition.calories * (1 - this.calculateCalorieLoss(losses)),
      protein: nutrition.protein * (1 - losses.protein),
      fat: nutrition.fat * (1 - losses.fat),
      carbohydrates: nutrition.carbohydrates * (1 - losses.carbohydrates)
    }
  }
  
  private calculateCalorieLoss(losses: any): number {
    // –ö–∞–ª–æ—Ä–∏–∏ —Ç–µ—Ä—è—é—Ç—Å—è –ø—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –ø–æ—Ç–µ—Ä–µ –º–∞–∫—Ä–æ–Ω—É—Ç—Ä–∏–µ–Ω—Ç–æ–≤
    return (losses.protein * 0.3 + losses.fat * 0.4 + losses.carbohydrates * 0.3)
  }
  
  // –†–∞—Å—á–µ—Ç –¥–Ω–µ–≤–Ω—ã—Ö –Ω–æ—Ä–º –ø–æ —Ñ–æ—Ä–º—É–ª–µ –ú–∏—Ñ—Ñ–ª–∏–Ω–∞-–°–∞–Ω –ñ–µ–æ—Ä–∞
  calculateDailyGoals(member: FamilyMember): NutritionGoals {
    let bmr: number
    
    if (member.gender === 'male') {
      bmr = 10 * member.weight + 6.25 * member.height - 5 * member.age + 5
    } else {
      bmr = 10 * member.weight + 6.25 * member.height - 5 * member.age - 161
    }
    
    const activityMultipliers = {
      'sedentary': 1.2,
      'light': 1.375,
      'moderate': 1.55,
      'active': 1.725,
      'very-active': 1.9
    }
    
    const totalCalories = bmr * activityMultipliers[member.activityLevel]
    
    return {
      calories: Math.round(totalCalories),
      protein: Math.round(totalCalories * 0.15 / 4), // 15% –∫–∞–ª–æ—Ä–∏–π –∏–∑ –±–µ–ª–∫–∞
      fat: Math.round(totalCalories * 0.25 / 9),      // 25% –∫–∞–ª–æ—Ä–∏–π –∏–∑ –∂–∏—Ä–æ–≤
      carbohydrates: Math.round(totalCalories * 0.60 / 4), // 60% –∫–∞–ª–æ—Ä–∏–π –∏–∑ —É–≥–ª–µ–≤–æ–¥–æ–≤
      calculationMethod: 'mifflin-st-jeor'
    }
  }
  
  // –ê–≥—Ä–µ–≥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å–µ–º—å–∏
  calculateFamilyProgress(family: Family, date: Date): FamilyNutritionSummary {
    const members = family.members.map(member => {
      const consumed = this.getMemberDailyConsumption(member.id, date)
      const goals = member.goals
      
      return {
        member,
        consumed,
        goals,
        progress: {
          calories: consumed.calories / goals.calories,
          protein: consumed.protein / goals.protein,
          fat: consumed.fat / goals.fat,
          carbohydrates: consumed.carbohydrates / goals.carbohydrates
        }
      }
    })
    
    return { members, date, familyId: family.id }
  }
}
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å —Ä–∞—Å—á–µ—Ç–æ–≤
- –£—á–µ—Ç —Ä–µ–∞–ª—å–Ω—ã—Ö –ø–æ—Ç–µ—Ä—å –ø—Ä–∏ –≥–æ—Ç–æ–≤–∫–µ
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã—Ö –Ω–æ—Ä–º
- –ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –¥–ª—è —Å–µ–º–µ–π
- –ù–∞—É—á–Ω–æ –æ–±–æ—Å–Ω–æ–≤–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—É–ª—ã

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**
- –í—ã—Å–æ–∫–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
- –ë–æ–ª—å—à–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –¥–∞–Ω–Ω—ã–º (—Å–ø–æ—Å–æ–±—ã –≥–æ—Ç–æ–≤–∫–∏)
- –°–ª–æ–∂–Ω–æ—Å—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏ –∫–∞–ª–∏–±—Ä–æ–≤–∫–∏
- –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –∏–∑–±—ã—Ç–æ—á–Ω–æ—Å—Ç—å –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö —Å–ª—É—á–∞–µ–≤
- –í—ã—Å–æ–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

**–í—Ä–µ–º–µ–Ω–Ω–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å:** O(n*m) –≥–¥–µ n - –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã, m - —ç—Ç–∞–ø—ã –≥–æ—Ç–æ–≤–∫–∏
**–ü—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å:** O(k + c) –≥–¥–µ k - –∫—ç—à, c - —Å–ø–æ—Å–æ–±—ã –≥–æ—Ç–æ–≤–∫–∏
**–û–±—Ä–∞–±–æ—Ç–∫–∞ –≥—Ä–∞–Ω–∏—á–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤:** –ü—Ä–µ–≤–æ—Å—Ö–æ–¥–Ω–∞—è
**–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å:** –°—Ä–µ–¥–Ω—è—è (—Ç—Ä–µ–±—É–µ—Ç –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏)

## üé® CREATIVE CHECKPOINT: –ê–Ω–∞–ª–∏–∑ –∞–ª–≥–æ—Ä–∏—Ç–º–∏—á–µ—Å–∫–∏—Ö –ø–æ–¥—Ö–æ–¥–æ–≤ –∑–∞–≤–µ—Ä—à–µ–Ω

**–ü—Ä–æ–≥—Ä–µ—Å—Å:** –û–ø—Ä–µ–¥–µ–ª–µ–Ω—ã 3 —É—Ä–æ–≤–Ω—è —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –∞–ª–≥–æ—Ä–∏—Ç–º–∞ —Ä–∞—Å—á–µ—Ç–∞ –ë–ñ–£
**–†–µ—à–µ–Ω–∏—è:** –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –∫–æ–º–ø—Ä–æ–º–∏—Å—Å—ã –º–µ–∂–¥—É —Ç–æ—á–Ω–æ—Å—Ç—å—é –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é
**–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:** –í—ã–±–æ—Ä –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è –∏ –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

## –†–ï–®–ï–ù–ò–ï

**–í—ã–±—Ä–∞–Ω–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç:** –í–∞—Ä–∏–∞–Ω—Ç 2 - –°–∏—Å—Ç–µ–º–∞ —Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∏ –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:**
1. **–ë–∞–ª–∞–Ω—Å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏:** –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ—â–Ω—ã–π –¥–ª—è –≤—Å–µ—Ö –æ—Å–Ω–æ–≤–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤
2. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –±—ã—Å—Ç—Ä—ã–µ –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ —Ä–∞—Å—á–µ—Ç—ã
3. **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å:** –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫–∏
4. **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å:** –õ–µ–≥–∫–æ —Ä–∞—Å—à–∏—Ä—è–µ—Ç—Å—è –¥–ª—è –Ω–æ–≤—ã—Ö —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π
5. **–ü—Ä–æ—Å—Ç–æ—Ç–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏:** –ü–æ–Ω—è—Ç–Ω—ã–π API –¥–ª—è UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
6. **–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑—É–µ–º–æ—Å—Ç—å:** –ù–µ —Ç—Ä–µ–±—É–µ—Ç —Å–ª–æ–∂–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –æ –≥–æ—Ç–æ–≤–∫–µ

**–î–æ–ø–æ–ª–Ω–µ–Ω–∏—è –∏–∑ –í–∞—Ä–∏–∞–Ω—Ç–∞ 3:**
- –§–æ—Ä–º—É–ª—ã —Ä–∞—Å—á–µ—Ç–∞ –¥–Ω–µ–≤–Ω—ã—Ö –Ω–æ—Ä–º (–ú–∏—Ñ—Ñ–ª–∏–Ω-–°–∞–Ω –ñ–µ–æ—Ä)
- –ê–≥—Ä–µ–≥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å–µ–º–µ–π–Ω–æ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –±—É–¥—É—â–µ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —É—á–µ—Ç–∞ –≥–æ—Ç–æ–≤–∫–∏

## –î–ï–¢–ê–õ–¨–ù–ê–Ø –ê–†–•–ò–¢–ï–ö–¢–£–†–ê –†–ï–®–ï–ù–ò–Ø

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–ª–∞—Å—Å—ã –∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã

```typescript
// –û—Å–Ω–æ–≤–Ω–æ–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä
export class NutritionCalculator {
  private cache: Map<string, NutritionData>
  private conversionService: UnitConversionService
  private validator: NutritionValidator
  
  // –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã
  calculateIngredientNutrition(ingredient: Ingredient, amount: number, unit: MeasurementUnit): NutritionData
  calculateRecipeNutrition(recipe: Recipe): NutritionData
  calculateMealNutrition(meal: Meal): NutritionData
  calculateDailyNutrition(meals: Meal[]): NutritionData
  
  // –£—Ç–∏–ª–∏—Ç—ã
  clearCache(): void
  getCacheStats(): CacheStats
}

// –°–µ—Ä–≤–∏—Å –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –µ–¥–∏–Ω–∏—Ü
export class UnitConversionService {
  private rules: Map<string, ConversionRule[]>
  
  convertToGrams(amount: number, unit: MeasurementUnit, ingredient: Ingredient): number
  getSupportedUnits(ingredient: Ingredient): MeasurementUnit[]
  addConversionRule(rule: ConversionRule): void
}

// –í–∞–ª–∏–¥–∞—Ç–æ—Ä –¥–∞–Ω–Ω—ã—Ö
export class NutritionValidator {
  validateIngredient(ingredient: Ingredient): ValidationResult
  validateAmount(amount: number, unit: MeasurementUnit): ValidationResult
  validateNutritionData(data: NutritionData): ValidationResult
}

// –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Ü–µ–ª–µ–≤—ã—Ö –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π
export class GoalsCalculator {
  calculateDailyGoals(member: FamilyMember, method: CalculationMethod): NutritionGoals
  calculateWeeklyGoals(member: FamilyMember): NutritionGoals
  adjustGoalsForActivity(goals: NutritionGoals, activityLevel: ActivityLevel): NutritionGoals
}

// –ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π —Å–µ—Ä–≤–∏—Å
export class NutritionAnalytics {
  calculateProgress(consumed: NutritionData, goals: NutritionGoals): ProgressData
  generateDailyReport(member: FamilyMember, date: Date): DailyReport
  generateWeeklyReport(member: FamilyMember, startDate: Date): WeeklyReport
  generateFamilyReport(family: Family, date: Date): FamilyReport
}
```

### –°–∏—Å—Ç–µ–º–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –µ–¥–∏–Ω–∏—Ü

```typescript
interface ConversionRule {
  fromUnit: MeasurementUnit
  toUnit: MeasurementUnit
  factor?: number
  formula?: (amount: number, ingredient: Ingredient) => number
  ingredientTypes?: string[] // –¥–ª—è –∫–∞–∫–∏—Ö —Ç–∏–ø–æ–≤ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤ –ø—Ä–∏–º–µ–Ω–∏–º–æ
}

// –ü—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏
const CONVERSION_RULES: ConversionRule[] = [
  // –ë–∞–∑–æ–≤—ã–µ –≤–µ—Å–æ–≤—ã–µ –µ–¥–∏–Ω–∏—Ü—ã
  { fromUnit: 'kilogram', toUnit: 'gram', factor: 1000 },
  { fromUnit: 'gram', toUnit: 'kilogram', factor: 0.001 },
  
  // –û–±—ä–µ–º–Ω—ã–µ –µ–¥–∏–Ω–∏—Ü—ã –¥–ª—è –∂–∏–¥–∫–æ—Å—Ç–µ–π
  { fromUnit: 'liter', toUnit: 'milliliter', factor: 1000 },
  { fromUnit: 'milliliter', toUnit: 'gram', formula: (amount, ingredient) => amount * (ingredient.density || 1) },
  
  // –ö—É–ª–∏–Ω–∞—Ä–Ω—ã–µ –µ–¥–∏–Ω–∏—Ü—ã
  { fromUnit: 'tablespoon', toUnit: 'milliliter', factor: 15 },
  { fromUnit: 'teaspoon', toUnit: 'milliliter', factor: 5 },
  { fromUnit: 'cup', toUnit: 'milliliter', factor: 240 },
  { fromUnit: 'glass', toUnit: 'milliliter', factor: 200 },
  
  // –®—Ç—É—á–Ω—ã–µ –µ–¥–∏–Ω–∏—Ü—ã (–∑–∞–≤–∏—Å—è—Ç –æ—Ç –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–∞)
  { 
    fromUnit: 'piece', 
    toUnit: 'gram', 
    formula: (amount, ingredient) => amount * (ingredient.averageWeight || 100),
    ingredientTypes: ['fruits', 'vegetables', 'eggs']
  },
  { 
    fromUnit: 'portion', 
    toUnit: 'gram', 
    formula: (amount, ingredient) => amount * (ingredient.portionWeight || 150)
  }
]
```

### –°–∏—Å—Ç–µ–º–∞ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è

```typescript
interface CacheEntry {
  result: NutritionData
  timestamp: number
  accessCount: number
}

class NutritionCache {
  private cache = new Map<string, CacheEntry>()
  private maxSize = 1000
  private ttl = 3600000 // 1 —á–∞—Å
  
  get(key: string): NutritionData | null {
    const entry = this.cache.get(key)
    if (!entry) return null
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ TTL
    if (Date.now() - entry.timestamp > this.ttl) {
      this.cache.delete(key)
      return null
    }
    
    entry.accessCount++
    return entry.result
  }
  
  set(key: string, result: NutritionData): void {
    // –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞ –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ —Ä–∞–∑–º–µ—Ä–∞
    if (this.cache.size >= this.maxSize) {
      this.evictLeastUsed()
    }
    
    this.cache.set(key, {
      result,
      timestamp: Date.now(),
      accessCount: 1
    })
  }
  
  private evictLeastUsed(): void {
    let leastUsedKey = ''
    let minAccessCount = Infinity
    
    for (const [key, entry] of this.cache) {
      if (entry.accessCount < minAccessCount) {
        minAccessCount = entry.accessCount
        leastUsedKey = key
      }
    }
    
    if (leastUsedKey) {
      this.cache.delete(leastUsedKey)
    }
  }
  
  generateKey(ingredientId: string, amount: number, unit: MeasurementUnit): string {
    return `${ingredientId}:${amount}:${unit}`
  }
}
```

### –§–æ—Ä–º—É–ª—ã —Ä–∞—Å—á–µ—Ç–∞ –¥–Ω–µ–≤–Ω—ã—Ö –Ω–æ—Ä–º

```typescript
class GoalsCalculator {
  // –§–æ—Ä–º—É–ª–∞ –ú–∏—Ñ—Ñ–ª–∏–Ω–∞-–°–∞–Ω –ñ–µ–æ—Ä–∞ (–Ω–∞–∏–±–æ–ª–µ–µ —Ç–æ—á–Ω–∞—è)
  calculateBMR(member: FamilyMember): number {
    const { weight, height, age, gender } = member
    
    if (gender === 'male') {
      return 10 * weight + 6.25 * height - 5 * age + 5
    } else {
      return 10 * weight + 6.25 * height - 5 * age - 161
    }
  }
  
  // –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
  private getActivityMultiplier(level: ActivityLevel): number {
    const multipliers = {
      'sedentary': 1.2,      // –ú–∞–ª–æ–ø–æ–¥–≤–∏–∂–Ω—ã–π –æ–±—Ä–∞–∑ –∂–∏–∑–Ω–∏
      'light': 1.375,        // –õ–µ–≥–∫–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å (1-3 –¥–Ω—è –≤ –Ω–µ–¥–µ–ª—é)
      'moderate': 1.55,      // –£–º–µ—Ä–µ–Ω–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å (3-5 –¥–Ω–µ–π –≤ –Ω–µ–¥–µ–ª—é)
      'active': 1.725,       // –í—ã—Å–æ–∫–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å (6-7 –¥–Ω–µ–π –≤ –Ω–µ–¥–µ–ª—é)
      'very-active': 1.9     // –û—á–µ–Ω—å –≤—ã—Å–æ–∫–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å (2 —Ä–∞–∑–∞ –≤ –¥–µ–Ω—å)
    }
    return multipliers[level]
  }
  
  // –†–∞—Å—á–µ—Ç –º–∞–∫—Ä–æ–Ω—É—Ç—Ä–∏–µ–Ω—Ç–æ–≤
  calculateMacroDistribution(totalCalories: number, profile: MacroProfile = 'balanced'): MacroDistribution {
    const profiles = {
      'balanced': { protein: 0.15, fat: 0.25, carbs: 0.60 },
      'high-protein': { protein: 0.25, fat: 0.25, carbs: 0.50 },
      'low-carb': { protein: 0.25, fat: 0.45, carbs: 0.30 },
      'mediterranean': { protein: 0.15, fat: 0.35, carbs: 0.50 }
    }
    
    const distribution = profiles[profile]
    
    return {
      protein: Math.round(totalCalories * distribution.protein / 4), // 4 –∫–∫–∞–ª/–≥
      fat: Math.round(totalCalories * distribution.fat / 9),          // 9 –∫–∫–∞–ª/–≥
      carbohydrates: Math.round(totalCalories * distribution.carbs / 4) // 4 –∫–∫–∞–ª/–≥
    }
  }
}
```

### API –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å UI

```typescript
// –û—Å–Ω–æ–≤–Ω–æ–π API –∫–ª–∞—Å—Å
export class NutritionAPI {
  private calculator: NutritionCalculator
  private analytics: NutritionAnalytics
  private goals: GoalsCalculator
  
  // –ú–µ—Ç–æ–¥—ã –¥–ª—è UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
  async calculateIngredientNutrition(ingredientId: string, amount: number, unit: string): Promise<NutritionData>
  async calculateRecipeNutrition(recipeId: string): Promise<NutritionData>
  async getMemberProgress(memberId: string, date: string): Promise<ProgressData>
  async getFamilyOverview(familyId: string, date: string): Promise<FamilyOverview>
  
  // –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ñ–æ—Ä–º
  getSupportedUnits(ingredientId: string): MeasurementUnit[]
  getPopularPortions(ingredientId: string): PopularPortion[]
  validateNutritionInput(data: any): ValidationResult
  
  // –ê–Ω–∞–ª–∏—Ç–∏–∫–∞
  generateNutritionChart(memberId: string, period: 'day' | 'week' | 'month'): ChartData
  exportNutritionData(memberId: string, format: 'csv' | 'json'): string
}

// –¢–∏–ø—ã –¥–ª—è UI
interface ProgressData {
  current: NutritionData
  target: NutritionData
  percentages: {
    calories: number
    protein: number
    fat: number
    carbohydrates: number
  }
  status: 'under' | 'optimal' | 'over'
}

interface PopularPortion {
  name: string
  amount: number
  unit: MeasurementUnit
  description: string
}
```

## –í–ê–õ–ò–î–ê–¶–ò–Ø –¢–†–ï–ë–û–í–ê–ù–ò–ô

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω—ã:**
- ‚úÖ –†–∞—Å—á–µ—Ç –ë–ñ–£ –¥–ª—è –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤, —Ä–µ—Ü–µ–ø—Ç–æ–≤, –ø—Ä–∏–µ–º–æ–≤ –ø–∏—â–∏
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –µ–¥–∏–Ω–∏—Ü –∏–∑–º–µ—Ä–µ–Ω–∏—è
- ‚úÖ –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –º–µ–∂–¥—É –µ–¥–∏–Ω–∏—Ü–∞–º–∏
- ‚úÖ –†–∞—Å—á–µ—Ç –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã—Ö –Ω–æ—Ä–º
- ‚úÖ –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
- ‚úÖ –î–Ω–µ–≤–Ω—ã–µ –∏ –Ω–µ–¥–µ–ª—å–Ω—ã–µ —Å–≤–æ–¥–∫–∏

**–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω—ã:**
- ‚úÖ –í—ã—Å–æ–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (–∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ)
- ‚úÖ –¢–æ—á–Ω–æ—Å—Ç—å —Ä–∞—Å—á–µ—Ç–æ–≤ (–æ–∫—Ä—É–≥–ª–µ–Ω–∏–µ –¥–æ 0.1–≥)
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–æ–≤ (—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö)
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

**–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –æ—Å—É—â–µ—Å—Ç–≤–∏–º–æ—Å—Ç—å:** –í—ã—Å–æ–∫–∞—è
**–û—Ü–µ–Ω–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:** –û—Ç–ª–∏—á–Ω–∞—è —Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º

## –ü–õ–ê–ù –†–ï–ê–õ–ò–ó–ê–¶–ò–ò

### –≠—Ç–∞–ø 1: –ë–∞–∑–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
1. –°–æ–∑–¥–∞–Ω–∏–µ –æ—Å–Ω–æ–≤–Ω—ã—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ –∏ —Ç–∏–ø–æ–≤
2. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ—Å—Ç–æ–≥–æ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ –ë–ñ–£
3. –ë–∞–∑–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –µ–¥–∏–Ω–∏—Ü
4. –ü—Ä–æ—Å—Ç–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

### –≠—Ç–∞–ø 2: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
1. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
2. –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è
3. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ –≥—Ä–∞–Ω–∏—á–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤
4. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –≠—Ç–∞–ø 3: –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
1. –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –¥–Ω–µ–≤–Ω—ã—Ö –Ω–æ—Ä–º
2. –ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏
3. API –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å UI
4. –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö

### –≠—Ç–∞–ø 4: –ü–æ–ª–∏—Ä–æ–≤–∫–∞ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
1. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤
2. –†–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
3. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API
4. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –±—É–¥—É—â–∏–º —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è–º

üé®üé®üé® EXITING CREATIVE PHASE - –†–ï–®–ï–ù–ò–ï –ü–†–ò–ù–Ø–¢–û üé®üé®üé®

**–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ:** –í—ã–±—Ä–∞–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ —Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∏ –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π –¥–ª—è –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–≥–æ –±–∞–ª–∞–Ω—Å–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
**–ö–ª—é—á–µ–≤—ã–µ —Ä–µ—à–µ–Ω–∏—è:**
- –ú–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å —á–µ—Ç–∫–∏–º —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏
- –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- –ì–∏–±–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –µ–¥–∏–Ω–∏—Ü –∏–∑–º–µ—Ä–µ–Ω–∏—è
- –ù–∞—É—á–Ω–æ –æ–±–æ—Å–Ω–æ–≤–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—É–ª—ã —Ä–∞—Å—á–µ—Ç–∞ –¥–Ω–µ–≤–Ω—ã—Ö –Ω–æ—Ä–º
- –ü—Ä–æ—Å—Ç–æ–π API –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏

**–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:** –ü–µ—Ä–µ—Ö–æ–¥ –∫ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—é —Å–∏—Å—Ç–µ–º—ã —Ñ–∞—Å–æ–≤–∫–∏ –ø—Ä–æ–¥—É–∫—Ç–æ–≤